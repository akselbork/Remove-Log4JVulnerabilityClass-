# Remove-Log4JVulnerabilityClass-
Log4J vulnerability Script to remove the "JndiLookup.Class" from JAR-files

<h1>SCRIPTS:</h1>
There is two diffent type of PS scripts.
Output examles are add beside the scripts.

<h2>Remove-Log4J_JndiLookupClass-PSv5.ps1 (Outdated)</h2>
This script can only run locally on a computer

<h2>Remove-Log4J_JndiLookupClassRemotely-PSv5.ps1</h2>
This script can run locally or/and against remote computers.



<h1>HELP</h1>
This section below, is the comment based help for "Remove-Log4J_JndiLookupClassRemotely-PSv5.ps1"<br

<#<br>
.SYNOPSIS<br>
CleanUp script for removing vulnerable Java class based on CVE-2021-45105<br>

.DESCRIPTION<br>
As the last resorse, the removing of the class file "JndiLookup.class" from the jar file containing it, can be necessary<br>
This script can find all jar files, or a single specified file,  with the vulnerability and remove it.<br>
You can also choose just to get a list of files that contains the class.<br>

.PARAMETER ComputerName<br>
Names or IP-addresses of computer to query<br>

.PARAMETER Credential<br>
Remote for accessing computers remotely<br> 

.PARAMETER file<br>
fullname of a single file to investigate<br>

.PARAMETER JavaClass<br>
The class name to remove<br>

.PARAMETER WorkFolder<br>
The folder to where the work on the file is done<br>
Default: "temp-log4j"<br>

.PARAMETER RootPath<br>
The drive the workfolder is created on<br>
Default: "C:""<br>

.PARAMETER Compressionlevel<br>
What type of compression should be used<br>
Default: "Fastest"<br>

.PARAMETER Out<br>
To get the result of the cleanup out as an Object<br>

.PARAMETER onlyQuery<br>
If only interesting in getting the numbers, and fullnames on files vulnerable<br>

.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -file "D:\ZIP\PAD.JavaBridge.jar" -out -onlyQuery -verbose<br>


.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -out -onlyQuery -verbose<br>


.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar"  -Verbose -out<br>
<br>
VERBOSE: 01:02:00.4698 [BEGIN  ] Starting Remove-Log4JVulnerabilityClassRemotely<br>
VERBOSE: 01:02:00.4778 [BEGIN  ] <br>
VERBOSE: 01:02:00.4778 [BEGIN  ] ####################################################################<br>
VERBOSE: 01:02:00.4788 [BEGIN  ] <br>
VERBOSE: 01:02:00.4798 [BEGIN  ] [INPUT][CREDENTIAL]          company\administrator<br>
VERBOSE: 01:02:00.4798 [BEGIN  ] [INPUT][COMPUTERS]           1<br>
VERBOSE: 01:02:00.4808 [BEGIN  ] [INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar<br>
VERBOSE: 01:02:00.4808 [BEGIN  ] [INPUT][JAVACLASS]           JndiLookup.class<br>
VERBOSE: 01:02:00.4818 [BEGIN  ] [INPUT][WORKFOLDER]          _temp-log4J<br>
VERBOSE: 01:02:00.4818 [BEGIN  ] [INPUT][ROOTPATH]            C:<br>
VERBOSE: 01:02:00.4828 [BEGIN  ] [INPUT][COMPRESSION]         Fastest<br>
VERBOSE: 01:02:00.4828 [BEGIN  ] [INPUT][INCLUDENETWORKSHARE] False<br>
VERBOSE: 01:02:00.4828 [BEGIN  ] [INPUT][WRITE OUTPUT]        True<br>
VERBOSE: 01:02:00.4858 [BEGIN  ] [INPUT][ONLYQUERY]           False<br>
VERBOSE: 01:02:00.4868 [BEGIN  ] [INPUT][VERBOSE]             Continue<br>
VERBOSE: 01:02:00.4868 [BEGIN  ] <br>
VERBOSE: 01:02:00.4868 [BEGIN  ] ####################################################################<br>
VERBOSE: 01:02:00.4878 [BEGIN  ] <br>
VERBOSE: 01:02:00.4888 [PROCESS] [COMPUTER][LOCAL] COMPUTER01<br>
VERBOSE: 01:02:00.4888 [BEGIN  ] [COMPUTER01] Starting<br>
VERBOSE: 01:02:00.4898 [BEGIN  ] [COMPUTER01][INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar<br>
VERBOSE: 01:02:00.4898 [BEGIN  ] [COMPUTER01][INPUT][JAVACLASS]           JndiLookup.class<br>
VERBOSE: 01:02:00.4908 [BEGIN  ] [COMPUTER01L][INPUT][WORKFOLDER]          _temp-log4J<br>
VERBOSE: 01:02:00.4958 [BEGIN  ] [COMPUTER01][INPUT][ROOTPATH]            C:<br>
VERBOSE: 01:02:00.4968 [BEGIN  ] [COMPUTER01][INPUT][COMPRESSION]         Fastest<br>
VERBOSE: 01:02:00.4978 [BEGIN  ] [COMPUTER01][INPUT][INCLUDENETWORKSHARE] False<br>
VERBOSE: 01:02:00.4978 [BEGIN  ] [COMPUTER01][INPUT][WRITE OUTPUT]        True<br>
VERBOSE: 01:02:00.4988 [BEGIN  ] [COMPUTER01][INPUT][ONLYQUERY]           False<br>
VERBOSE: 01:02:00.4988 [BEGIN  ] [COMPUTER01][INPUT][VERBOSE]             True<br>
VERBOSE: 01:02:00.4998 [BEGIN  ] [COMPUTER01][QUERING][FILE] D:\ZIP\PAD.JavaBridge.jar<br>
VERBOSE: 01:02:00.5678 [BEGIN  ] [COMPUTER01][QUERING] files found [1]<br>
VERBOSE: 01:02:00.5688 [PROCESS] [COMPUTER01][DIRECTORY] creating work folder [C:\_temp-log4J]<br>
VERBOSE: 01:02:00.5708 [PROCESS] [COMPUTER01][DIRECTORY] Creating folder [C:\_temp-log4J\ZIP]<br>
VERBOSE: 01:02:00.5718 [PROCESS] [COMPUTER01][FILENAME] D:\ZIP\PAD.JavaBridge.jar<br>
VERBOSE: 01:02:00.5738 [PROCESS] [COMPUTER01][COPY/RENAME] file [D:\ZIP\PAD.JavaBridge.jar] to [C:\_temp-log4J\PAD.JavaBridge.zip]<br>
VERBOSE: 01:02:00.5758 [PROCESS] [COMPUTER01][EXPAND] file [C:\_temp-log4J\PAD.JavaBridge.zip] to folder [C:\_temp-log4J\ZIP]<br>
VERBOSE: 01:02:03.6663 [PROCESS] [COMPUTER01][REMOVING CLASS][C:\_temp-log4J\ZIP\org\apache\logging\log4j\core\lookup\JndiLookup.class] class [JndiLookup.class]<br>
VERBOSE: 01:02:03.6713 [PROCESS] [COMPUTER01][COMPRESS] file [C:\_temp-log4J\ZIP] to [C:\_temp-log4J\PAD.JavaBridge.zip]<br>
VERBOSE: 01:02:05.2889 [PROCESS] [COMPUTER01][COPY/RENAME] file [C:\_temp-log4J\PAD.JavaBridge.zip] to [D:\ZIP\PAD.JavaBridge.jar]<br>
VERBOSE: 01:02:05.2979 [PROCESS] [COMPUTER01][CLEANUP] Deleting folder [C:\_temp-log4J]<br>
VERBOSE: 01:02:05.5099 [PROCESS] [DCOMPUTER01][CLEANUP] Status cleanup [Successful]<br>
VERBOSE: 01:02:05.5619 [PROCESS] [COMPUTER01][FILENAME][D:\ZIP\PAD.JavaBridge.jar] Status [CLEANED]<br>
<br>
<br>
FileName     : PAD.JavaBridge.jar<br>
FullName     : D:\ZIP\PAD.JavaBridge.jar<br>
Cleaned      : True<br>
Action       : Clean<br>
ComputerName : COMPUTER01<br>
QueryDate    : 22-12-2021 01:02:05<br>
<br>
<br>
VERBOSE: 01:02:05.5679 [END    ] [COMPUTER01]  Ending Remove-Log4JVulnerabilityClass<br>
VERBOSE: 01:02:05.5679 [END    ] <br>
VERBOSE: 01:02:05.5689 [END    ] Ending Remove-Log4JVulnerabilityClassRemotely<br>
VERBOSE: 01:02:05.5689 [END    ] <br>
VERBOSE: 01:02:05.5699 [END    ] ####################################################################<br>
VERBOSE: 01:02:05.5699 [END    ] [STARTTIME] 12/22/2021 01:02:00<br>
VERBOSE: 01:02:05.5709 [END    ] [ENDTIME]   12/22/2021 01:02:05<br>
VERBOSE: 01:02:05.5709 [END    ] [RUNTIME]   00d:00h:00m:05s<br>
VERBOSE: 01:02:05.5719 [END    ] ####################################################################<br>


.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar" -out -onlyQuery -verbose<br>


.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -credential (get-credential) -out -onlyQuery -verbose<br>


.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -computername Fil01 -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar"  -Verbose -out<br>

.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -computername Fil01 -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar" -out -onlyQuery -verbose<br>

VERBOSE: 23:31:21.5044 [BEGIN  ] Starting Remove-Log4JVulnerabilityClassRemotely<br>
VERBOSE: 23:31:21.5199 [BEGIN  ] <br>
VERBOSE: 23:31:21.5199 [BEGIN  ] ####################################################################<br>
VERBOSE: 23:31:21.5199 [BEGIN  ] <br>
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][CREDENTIAL]          company\administrator<br>
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][COMPUTERS]           1<br>
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar<br>
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][JAVACLASS]           JndiLookup.class<br>
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][WORKFOLDER]          _temp-log4J<br>
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][ROOTPATH]            C:<br>
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][COMPRESSION]         Fastest<br>
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][INCLUDENETWORKSHARE] False<br>
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][WRITE OUTPUT]        True<br>
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][ONLYQUERY]           True<br>
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][VERBOSE]             Continue<br>
VERBOSE: 23:31:21.5356 [BEGIN  ] <br>
VERBOSE: 23:31:21.5356 [BEGIN  ] ####################################################################<br>
VERBOSE: 23:31:21.5356 [BEGIN  ] <br>
VERBOSE: 23:31:21.5511 [PROCESS] [COMPUTER][REMOTE] Fil01<br>
VERBOSE: 23:31:21.5511 [PROCESS] [COMPUTER][REMOTE][Fil01] Accessable status [TRUE]<br>
VERBOSE: 23:31:22.1237 [BEGIN  ] [FIL01] Starting<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][JAVACLASS]           JndiLookup.class<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][WORKFOLDER]          _temp-log4J<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][ROOTPATH]            C:<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][COMPRESSION]         Fastest<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][INCLUDENETWORKSHARE] False<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][WRITE OUTPUT]        True<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][ONLYQUERY]           True<br>
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][VERBOSE]             True<br>
VERBOSE: 23:31:22.1862 [BEGIN  ] [FIL01][QUERING][FILE] D:\ZIP\PAD.JavaBridge.jar<br>
VERBOSE: 23:31:22.2018 [BEGIN  ] [FIL01][QUERING][FILE] D:\ZIP\PAD.JavaBridge.jar - does not exists<br>
VERBOSE: 23:31:22.2330 [BEGIN  ] [FIL01][QUERING] files found [0]<br>
<br>
<br>
FileName       : <br>
FullName       : <br>
Cleaned        : True<br>
Action         : onlyQuery<br>
ComputerName   : FIL01<br>
QueryDate      : 12/21/2021 11:31:22 PM<br>
PSComputerName : Fil01<br>
RunspaceId     : 8054891b-0f6b-4ab4-b351-50e6db368086<br>
<br>
VERBOSE: 23:31:22.2487 [END    ] [FIL01]  Ending <br>
VERBOSE: 23:31:22.2854 [END    ] <br>
VERBOSE: 23:31:22.2854 [END    ] Ending Remove-Log4JVulnerabilityClassRemotely<br>
VERBOSE: 23:31:22.2854 [END    ] <br>
VERBOSE: 23:31:22.2854 [END    ] ####################################################################<br>
VERBOSE: 23:31:22.2854 [END    ] [STARTTIME] 12/21/2021 23:31:21<br>
VERBOSE: 23:31:22.3012 [END    ] [ENDTIME]   12/21/2021 23:31:22<br>
VERBOSE: 23:31:22.3012 [END    ] [RUNTIME]   00d:00h:00m:00s<br>
VERBOSE: 23:31:22.3012 [END    ] ####################################################################<br>
<br>
<br>
.EXAMPLE<br>
Remove-Log4JVulnerabilityClassRemotely -computername Fil01 -credential $cred -out -onlyQuery<br>
<br>
<br>
FileName       : <br>
FullName       : C:\_FILES\PAD.JavaBridge-2.jar | S:\Data\FILES\PAD.JavaBridge-2.jar | S:\Share\FILES\PAD.JavaBridge-2.jar<br>
Cleaned        : False<br>
Action         : onlyQeury<br>
ComputerName   : FIL01<br>
QueryDate      : 12/21/2021 11:36:59 PM<br>
PSComputerName : Fil01<br>
RunspaceId     : 29191d74-f5b6-487b-9588-a164aaf73101<br>



.NOTES<br>

AUTHOR:     Aksel Bork<br>
Date:       2021-12-22<br>
PSVersion:  5<br>
Version:    1       Creation<br>

.LINK<br>



#><br>
