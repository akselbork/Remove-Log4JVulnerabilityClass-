# Remove-Log4JVulnerabilityClass-
Log4J vulnerability Script to remove the "JndiLookup.Class" from JAR-files

<h1>SCRIPTS:</h1>
There is two diffent type of PS scripts.
Output examles are add beside the scripts.

<h2>Remove-Log4J_JndiLookupClass-PSv5.ps1 (Outdated)</h2>
This script can only run locally on a computer

<h2>Remove-Log4J_JndiLookupClassRemotely-PSv5.ps1</h2>
This script can run locally or/and against remote computers.



<h1>HELP</h1>
This section below, is the comment based help for "Remove-Log4J_JndiLookupClassRemotely-PSv5.ps1"

<#
.SYNOPSIS
CleanUp script for removing vulnerable Java class based on CVE-2021-45105

.DESCRIPTION
As the last resorse, the removing of the class file "JndiLookup.class" from the jar file containing it, can be necessary
This script can find all jar files, or a single specified file,  with the vulnerability and remove it.
You can also choose just to get a list of files that contains the class.

.PARAMETER ComputerName
Names or IP-addresses of computer to query

.PARAMETER Credential
Remote for accessing computers remotely 

.PARAMETER file
fullname of a single file to investigate

.PARAMETER JavaClass
The class name to remove

.PARAMETER WorkFolder
The folder to where the work on the file is done
Default: "temp-log4j"

.PARAMETER RootPath
The drive the workfolder is created on
Default: "C:""

.PARAMETER Compressionlevel
What type of compression should be used
Default: "Fastest"

.PARAMETER Out
To get the result of the cleanup out as an Object

.PARAMETER onlyQuery
If only interesting in getting the numbers, and fullnames on files vulnerable

.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -file "D:\ZIP\PAD.JavaBridge.jar" -out -onlyQuery -verbose


.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -out -onlyQuery -verbose


.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar"  -Verbose -out

VERBOSE: 01:02:00.4698 [BEGIN  ] Starting Remove-Log4JVulnerabilityClassRemotely
VERBOSE: 01:02:00.4778 [BEGIN  ] 
VERBOSE: 01:02:00.4778 [BEGIN  ] ####################################################################
VERBOSE: 01:02:00.4788 [BEGIN  ] 
VERBOSE: 01:02:00.4798 [BEGIN  ] [INPUT][CREDENTIAL]          company\administrator
VERBOSE: 01:02:00.4798 [BEGIN  ] [INPUT][COMPUTERS]           1
VERBOSE: 01:02:00.4808 [BEGIN  ] [INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar
VERBOSE: 01:02:00.4808 [BEGIN  ] [INPUT][JAVACLASS]           JndiLookup.class
VERBOSE: 01:02:00.4818 [BEGIN  ] [INPUT][WORKFOLDER]          _temp-log4J
VERBOSE: 01:02:00.4818 [BEGIN  ] [INPUT][ROOTPATH]            C:
VERBOSE: 01:02:00.4828 [BEGIN  ] [INPUT][COMPRESSION]         Fastest
VERBOSE: 01:02:00.4828 [BEGIN  ] [INPUT][INCLUDENETWORKSHARE] False
VERBOSE: 01:02:00.4828 [BEGIN  ] [INPUT][WRITE OUTPUT]        True
VERBOSE: 01:02:00.4858 [BEGIN  ] [INPUT][ONLYQUERY]           False
VERBOSE: 01:02:00.4868 [BEGIN  ] [INPUT][VERBOSE]             Continue
VERBOSE: 01:02:00.4868 [BEGIN  ] 
VERBOSE: 01:02:00.4868 [BEGIN  ] ####################################################################
VERBOSE: 01:02:00.4878 [BEGIN  ] 
VERBOSE: 01:02:00.4888 [PROCESS] [COMPUTER][LOCAL] COMPUTER01
VERBOSE: 01:02:00.4888 [BEGIN  ] [COMPUTER01] Starting
VERBOSE: 01:02:00.4898 [BEGIN  ] [COMPUTER01][INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar
VERBOSE: 01:02:00.4898 [BEGIN  ] [COMPUTER01][INPUT][JAVACLASS]           JndiLookup.class
VERBOSE: 01:02:00.4908 [BEGIN  ] [COMPUTER01L][INPUT][WORKFOLDER]          _temp-log4J
VERBOSE: 01:02:00.4958 [BEGIN  ] [COMPUTER01][INPUT][ROOTPATH]            C:
VERBOSE: 01:02:00.4968 [BEGIN  ] [COMPUTER01][INPUT][COMPRESSION]         Fastest
VERBOSE: 01:02:00.4978 [BEGIN  ] [COMPUTER01][INPUT][INCLUDENETWORKSHARE] False
VERBOSE: 01:02:00.4978 [BEGIN  ] [COMPUTER01][INPUT][WRITE OUTPUT]        True
VERBOSE: 01:02:00.4988 [BEGIN  ] [COMPUTER01][INPUT][ONLYQUERY]           False
VERBOSE: 01:02:00.4988 [BEGIN  ] [COMPUTER01][INPUT][VERBOSE]             True
VERBOSE: 01:02:00.4998 [BEGIN  ] [COMPUTER01][QUERING][FILE] D:\ZIP\PAD.JavaBridge.jar
VERBOSE: 01:02:00.5678 [BEGIN  ] [COMPUTER01][QUERING] files found [1]
VERBOSE: 01:02:00.5688 [PROCESS] [COMPUTER01][DIRECTORY] creating work folder [C:\_temp-log4J]
VERBOSE: 01:02:00.5708 [PROCESS] [COMPUTER01][DIRECTORY] Creating folder [C:\_temp-log4J\ZIP]
VERBOSE: 01:02:00.5718 [PROCESS] [COMPUTER01][FILENAME] D:\ZIP\PAD.JavaBridge.jar
VERBOSE: 01:02:00.5738 [PROCESS] [COMPUTER01][COPY/RENAME] file [D:\ZIP\PAD.JavaBridge.jar] to [C:\_temp-log4J\PAD.JavaBridge.zip]
VERBOSE: 01:02:00.5758 [PROCESS] [COMPUTER01][EXPAND] file [C:\_temp-log4J\PAD.JavaBridge.zip] to folder [C:\_temp-log4J\ZIP]
VERBOSE: 01:02:03.6663 [PROCESS] [COMPUTER01][REMOVING CLASS][C:\_temp-log4J\ZIP\org\apache\logging\log4j\core\lookup\JndiLookup.class] class [JndiLookup.class]
VERBOSE: 01:02:03.6713 [PROCESS] [COMPUTER01][COMPRESS] file [C:\_temp-log4J\ZIP] to [C:\_temp-log4J\PAD.JavaBridge.zip]
VERBOSE: 01:02:05.2889 [PROCESS] [COMPUTER01][COPY/RENAME] file [C:\_temp-log4J\PAD.JavaBridge.zip] to [D:\ZIP\PAD.JavaBridge.jar]
VERBOSE: 01:02:05.2979 [PROCESS] [COMPUTER01][CLEANUP] Deleting folder [C:\_temp-log4J]
VERBOSE: 01:02:05.5099 [PROCESS] [DCOMPUTER01][CLEANUP] Status cleanup [Successful]
VERBOSE: 01:02:05.5619 [PROCESS] [COMPUTER01][FILENAME][D:\ZIP\PAD.JavaBridge.jar] Status [CLEANED]


FileName     : PAD.JavaBridge.jar
FullName     : D:\ZIP\PAD.JavaBridge.jar
Cleaned      : True
Action       : Clean
ComputerName : COMPUTER01
QueryDate    : 22-12-2021 01:02:05


VERBOSE: 01:02:05.5679 [END    ] [COMPUTER01]  Ending Remove-Log4JVulnerabilityClass
VERBOSE: 01:02:05.5679 [END    ] 
VERBOSE: 01:02:05.5689 [END    ] Ending Remove-Log4JVulnerabilityClassRemotely
VERBOSE: 01:02:05.5689 [END    ] 
VERBOSE: 01:02:05.5699 [END    ] ####################################################################
VERBOSE: 01:02:05.5699 [END    ] [STARTTIME] 12/22/2021 01:02:00
VERBOSE: 01:02:05.5709 [END    ] [ENDTIME]   12/22/2021 01:02:05
VERBOSE: 01:02:05.5709 [END    ] [RUNTIME]   00d:00h:00m:05s
VERBOSE: 01:02:05.5719 [END    ] ####################################################################


.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar" -out -onlyQuery -verbose


.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -credential (get-credential) -out -onlyQuery -verbose


.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -computername Fil01 -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar"  -Verbose -out

.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -computername Fil01 -credential (get-credential) -file "D:\ZIP\PAD.JavaBridge.jar" -out -onlyQuery -verbose

VERBOSE: 23:31:21.5044 [BEGIN  ] Starting Remove-Log4JVulnerabilityClassRemotely
VERBOSE: 23:31:21.5199 [BEGIN  ] 
VERBOSE: 23:31:21.5199 [BEGIN  ] ####################################################################
VERBOSE: 23:31:21.5199 [BEGIN  ] 
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][CREDENTIAL]          company\administrator
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][COMPUTERS]           1
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][JAVACLASS]           JndiLookup.class
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][WORKFOLDER]          _temp-log4J
VERBOSE: 23:31:21.5199 [BEGIN  ] [INPUT][ROOTPATH]            C:
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][COMPRESSION]         Fastest
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][INCLUDENETWORKSHARE] False
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][WRITE OUTPUT]        True
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][ONLYQUERY]           True
VERBOSE: 23:31:21.5356 [BEGIN  ] [INPUT][VERBOSE]             Continue
VERBOSE: 23:31:21.5356 [BEGIN  ] 
VERBOSE: 23:31:21.5356 [BEGIN  ] ####################################################################
VERBOSE: 23:31:21.5356 [BEGIN  ] 
VERBOSE: 23:31:21.5511 [PROCESS] [COMPUTER][REMOTE] Fil01
VERBOSE: 23:31:21.5511 [PROCESS] [COMPUTER][REMOTE][Fil01] Accessable status [TRUE]
VERBOSE: 23:31:22.1237 [BEGIN  ] [FIL01] Starting
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][FILE]                D:\ZIP\PAD.JavaBridge.jar
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][JAVACLASS]           JndiLookup.class
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][WORKFOLDER]          _temp-log4J
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][ROOTPATH]            C:
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][COMPRESSION]         Fastest
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][INCLUDENETWORKSHARE] False
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][WRITE OUTPUT]        True
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][ONLYQUERY]           True
VERBOSE: 23:31:22.1393 [BEGIN  ] [FIL01][INPUT][VERBOSE]             True
VERBOSE: 23:31:22.1862 [BEGIN  ] [FIL01][QUERING][FILE] D:\ZIP\PAD.JavaBridge.jar
VERBOSE: 23:31:22.2018 [BEGIN  ] [FIL01][QUERING][FILE] D:\ZIP\PAD.JavaBridge.jar - does not exists 
VERBOSE: 23:31:22.2330 [BEGIN  ] [FIL01][QUERING] files found [0]


FileName       : 
FullName       : 
Cleaned        : True
Action         : onlyQuery
ComputerName   : FIL01
QueryDate      : 12/21/2021 11:31:22 PM
PSComputerName : Fil01
RunspaceId     : 8054891b-0f6b-4ab4-b351-50e6db368086

VERBOSE: 23:31:22.2487 [END    ] [FIL01]  Ending 
VERBOSE: 23:31:22.2854 [END    ] 
VERBOSE: 23:31:22.2854 [END    ] Ending Remove-Log4JVulnerabilityClassRemotely
VERBOSE: 23:31:22.2854 [END    ] 
VERBOSE: 23:31:22.2854 [END    ] ####################################################################
VERBOSE: 23:31:22.2854 [END    ] [STARTTIME] 12/21/2021 23:31:21
VERBOSE: 23:31:22.3012 [END    ] [ENDTIME]   12/21/2021 23:31:22
VERBOSE: 23:31:22.3012 [END    ] [RUNTIME]   00d:00h:00m:00s
VERBOSE: 23:31:22.3012 [END    ] ####################################################################


.EXAMPLE
Remove-Log4JVulnerabilityClassRemotely -computername Fil01 -credential $cred -out -onlyQuery


FileName       : 
FullName       : C:\_FILES\PAD.JavaBridge-2.jar | S:\Data\FILES\PAD.JavaBridge-2.jar | S:\Share\FILES\PAD.JavaBridge-2.jar
Cleaned        : False
Action         : onlyQeury
ComputerName   : FIL01
QueryDate      : 12/21/2021 11:36:59 PM
PSComputerName : Fil01
RunspaceId     : 29191d74-f5b6-487b-9588-a164aaf73101



.NOTES

AUTHOR:     Aksel Bork
Date:       2021-12-22
PSVersion:  5
Version:    1       Creation

.LINK



#>
